# Clase 03/03/23 #
## Resumen ##
### Conexión base de datos ###

Al proyecto que hemos venido trabajando en las clases pasadas de vamos a agregar un nuevo método en la clase PersonaController.java
```java
   @GetMapping(
            value= "/personas", 
            produces = "application/json; charset=utf-8")
    public List<Persona> personas() {
        return primeraImplementacion.getAll();
    }
```
Vamos a la clase PersonaController nos arroja un error, ya que no existe el método .getall ni la palabra List

![image](https://user-images.githubusercontent.com/123017277/222854474-f75c5f1c-560e-43d6-b730-f4faacc6097e.png)

Para solucionar el problema con la palabra List ponemos el cursor sobre la palabra y se despliega un menú en la cual nos aparece una serie de posible soluciones, seleccionamos la primera opción que es “import ‘List’ (java.util)”. Una vez que le damos clic nos va a importar List y con eso queda solucionado el primer error.

![image](https://user-images.githubusercontent.com/123017277/222855199-e0028aca-5991-4241-a476-d61c6dcad813.png)

Ahora a solucionar el error de .getall si ubicamos el cursor sobre la palabra getall nos arroja dos posibles soluciones, una es crear el método getall en PersonaService o crear un cast para recibir el método, le damos en la primera opción y en automático nos crea el método en la interface PersonaService.

![image](https://user-images.githubusercontent.com/123017277/222856186-c395d9c9-53f3-4b01-b35d-f3e1608607ae.png)

Con eso queda resuelto el problema de getall en la interface Persona Controller, pero ahora tenemos otros dos problemas, ya que en PersonaServiceImpl y PersonaServiceImpl2, puesto que no contienen el método getall.

![image](https://user-images.githubusercontent.com/123017277/222856557-477da64a-7631-4492-86b1-e49e903d318e.png)

Para solucionar esto vamos a PersonaServiceImpl.java y nos posicionamos con el cursor en la palabra PersonaServiceImpl y se despliega un menú con algunas opciones para solucionar el problema, damos clic a la primera opción.

![image](https://user-images.githubusercontent.com/123017277/222857883-192534bd-3b4c-46e6-9195-8cf7b64839eb.png)

Cuando damos clic nos agrega un método en la clase PersonaServiceImpl.java que no hace nada

![image](https://user-images.githubusercontent.com/123017277/222863619-185aa58f-f786-466d-b445-048699269af3.png)

Lo que vamos a hacer es modificarlo, borramos la línea 19 y en vez de null Escribimos personaMapper quedando de la siguiente manera

![image](https://user-images.githubusercontent.com/123017277/222864881-ccdb0ebc-61c2-4da9-94ca-304a7bf0dcbb.png)

Copiamos el método y lo pegamos en PersonaServiceImpl2.java, con esto quedan resueltos los problemas que teníamos en el programa

Para continuar vamos la clase PersonaMapper  en la cual tenemos un método que nos regresa nulll por lo que para arreglar esto insertaremos unas nuevas líneas

![image](https://user-images.githubusercontent.com/123017277/222871007-11e20d43-524b-4a64-b942-21489bf3ba73.png)

con esto estamos fingiendo que nuestro programa va a una base de datos, si corremos nuestro programa y vamos al navegador vamos a ver el siguiente resultado

![image](https://user-images.githubusercontent.com/123017277/222871448-d93c9950-7539-4dd0-918c-2934584d029f.png)

para poder hacer que nuestro programa vaya en realidad a una base de datos:

1. Darle los parámetros de conexión(ir a la carpeta src/main/resources adentro archivo llamado aplication.properties y en este archivo escribimos las siguientes líneas).
```
spring.datasource.url=jdbc:mariadb://54.165.81.195:3307/publisher
spring.datasource.username=garellano
spring.datasource.password=garellano
spring.datasource.validationQuery=SELECT 1
```
2. Cargar las bibliotecas(dependencias) en el archivo pom.xml(org.mariadb.jdbc, com.zaxxer y org.mybatis.spring.boot).
```
         <dependency>
            <groupId>org.mariadb.jdbc</groupId>
            <artifactId>mariadb-java-client</artifactId>
        </dependency>
        <dependency>
            <groupId>com.zaxxer</groupId>
            <artifactId>HikariCP</artifactId>
        </dependency
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>1.3.0</version>
        </dependency>
        >
```
Al darle guardar vemos como en la parte inferior se empiezan a cargar.

![image](https://user-images.githubusercontent.com/123017277/222872828-8c0b7130-11c7-4d22-9be6-98f33d93b46f.png)

3. Indicar a Spring Boot donde se encuentran las clases de los mappers(en la clase App copiamos la siguiente línea).

```
@MapperScan("com.example.helloworld.controller")
```

![image](https://user-images.githubusercontent.com/123017277/222873049-aa673191-febb-4005-9d24-7db73b1d3dd2.png)

Al pegar la línea nos arroja un error, lo cual corregimos posicionándonos con el cursor sobre la palabra MapperScan y se muestra un menú, damos clic en la primera opción e importamos MapperScan.

![image](https://user-images.githubusercontent.com/123017277/222873316-9e0fb3b5-7aa0-4aaf-8578-ae00ded0bcb7.png)

![image](https://user-images.githubusercontent.com/123017277/222873299-a28179fa-1389-4ab2-bc93-66f6bf2dedbf.png)

Con esto queda completo el paso 3.

4. Convertir a Persona Mapper en una interface

![cambio](https://user-images.githubusercontent.com/123017277/222873673-c50612ae-8d13-4349-a03d-ce7d0fbcb729.gif)

4.1. Hacer que cada método sea un prototipo (ya que las interfaces no llevan código dentro solo la firma)
           
![body](https://user-images.githubusercontent.com/123017277/222873844-2fe1f4c2-c7b5-4a53-8278-ec2346de6cde.gif)

4.2. Agregar anotaciones de base de datos al Mapper.

agregamos al primer metodo

@Select("SELECT * FROM Persona")

arroja un error y nos pide importar Select

![image](https://user-images.githubusercontent.com/123017277/222874213-170d22d9-41ab-4f84-b4e1-f510936ac864.png)

en la importacion le cambiamos la palabra SELECT por un asteristo esto quiere decir que va a importar tanto el SELECT, el UPDATE, el INSERT y el DELETE.

![asterisco](https://user-images.githubusercontent.com/123017277/222874277-ee18bebb-24b8-4134-97e5-1e1dacd1d908.gif)

@Insert("INSERT INTO Persona VALUES(#{id},#{nombre},#{apPat},#{apMaterno},#{sueldo},#{genero})")

@Update("UPDATE Persona SET nombre=#{nombre}, apPat=#{apPat}, apMaterno=#{apMaterno}, sueldo=#{sueldo}, genero=#{genero}, WHERE id=#{idPersona} ")

@Delete("DELETE FROM Persona WHERE id=#{idPersona}")
